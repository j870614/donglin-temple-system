import{A as g,P as d}from"./index-32937c73.js";import{a as n}from"./SweetAlert-183ed47c.js";const{VITE_BASEURL:m}={VITE_BASEURL:"https://donglin-temple-backend-00pk.onrender.com/api",BASE_URL:"/donglin-temple-system/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},h=g("userStore",{state:()=>({isLogin:!1,user:{DharmaName:"",Name:""},deaconName:""}),actions:{async checkLogin(e){if(this.isLogin=!!localStorage.isLogin,!e){this.overLogin();return}this.user=sessionStorage.user&&JSON.parse(sessionStorage.user),this.deaconName=sessionStorage.deaconName,d.defaults.headers.common.Authorization=`Bearer ${e}`;const a=`${m}/managers/check`;try{if((await d.post(a)).data.status&&!this.isLogin&&(this.isLogin=!0,localStorage.setItem("isLogin","true")),this.user)return;const c=await d.get(`${m}/managers/profile`),{userId:s,deaconName:i}=c.data.data,t=await d.get(`${m}/users/${s}`),{user:r}=t.data.data;this.user=r,this.deaconName=i,sessionStorage.setItem("deaconName",i),sessionStorage.setItem("user",JSON.stringify(r))}catch(o){console.error(o),this.overLogin()}},async login(e,a,o=!1,c){const s=`${m}/managers/signin`,i={Email:e,Password:a};try{const t=await d.post(s,i);if(t.data.status){o?localStorage.setItem("userAccount",e):localStorage.removeItem("userAccount");const r=await n.fire(t.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",t.data.data.deaconName),(r.isConfirmed||r.isDismissed)&&(document.cookie=`token=${t.data.data.token}; expires=${new Date(t.data.data.expired*1e3)}`,c.push("/"))}}catch(t){n.fire({icon:"error",title:t.response.data.message})}},async lineLogin(e,a){const o=`${m}/managers/line/signin`,c=e;try{const s=await d.post(o,c);if(s.data.status){const i=await n.fire(s.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",s.data.data.deaconName),(i.isConfirmed||i.isDismissed)&&(document.cookie=`token=${s.data.data.token}; expires=${new Date(s.data.data.expired*1e3)}`,a.push("/"))}}catch(s){n.fire({icon:"error",title:s.response.data.message})}},async register(e,a,o,c,s){const i=`${m}/managers/signup${s?`/${s}`:""}`,t={Email:e,Password:a,ConfirmPassword:o,UserId:c};try{if((await d.post(i,t)).data.status){const l=await n.fire("註冊成功");this.clearCookie(),(l.isConfirmed||l.isDismissed)&&(window.location.href="/")}}catch(r){n.fire({icon:"error",title:r.response.data.message}),console.error(r.response.data)}},async signOut(e){this.clearCookie();const a=await n.fire("登出成功");(a.isConfirmed||a.isDismissed)&&e.push("/")},async overLogin(){if(this.clearCookie(),window.location.hash!=="#/"){const e=await n.fire("請重新登入");(e.isConfirmed||e.isDismissed)&&(window.location.href=`${window.location.origin}/#/admin`)}},clearCookie(){this.isLogin=!1,localStorage.setItem("isLogin","false"),document.cookie=`token=;expires=${new Date}`,sessionStorage.clear()},getToken(){var a;return document.cookie.includes("token")&&((a=document.cookie.split("; ").find(o=>o.startsWith("token=")))==null?void 0:a.split("=")[1])||""}}});export{h as u};
