import{f as F,g as f,B as Y,h as R,c as o,a as t,b as C,w as y,k as b,M,u as d,F as p,v,i as N,t as l,R as I,r as j,o as n,j as k,x as D,l as A,D as P,p as T,e as z,_ as E}from"./index-aa72e6c4.js";import{B as q}from"./BuddhaStore-3741c560.js";import{_ as G}from"./StickyTable.vue_vue_type_script_setup_true_lang-d9453a5c.js";import{_ as H}from"./BackTitle.vue_vue_type_script_setup_true_lang-32fb9256.js";import{a as $}from"./SweetAlert-183ed47c.js";import{g as S,a as O,f as U}from"./Timer-8447a705.js";import{t as L}from"./TagStyle-77d4d103.js";import"./GuestStore-d68f27ce.js";import"./UserStore-e501c0cf.js";import"./OpenSideBar.vue_vue_type_script_setup_true_lang-3231bebf.js";const c=g=>(T("data-v-7716bf8f"),g=g(),z(),g),J={class:"row"},K={class:"col h-100 gx-xl-5 pt-xl-4 pb-xl-5 py-3 mb-xl-2"},Q={class:"d-flex flex-column flex-xl-row gap-xl-4 gap-2 mb-3 mb-xl-4"},W=c(()=>t("label",{class:"form-label fw-semibold fs-5",for:"year"},"年份",-1)),X=["value","selected"],Z=c(()=>t("label",{class:"form-label fw-semibold fs-5",for:"month"},"月份",-1)),ee=["value","selected"],te={key:0,class:"material-symbols-outlined fs-6"},le={key:0},ae=c(()=>t("td",{colspan:"12"},"當前月份無報名資訊",-1)),se=[ae],oe=["onClick"],ne={key:0,class:"mb-0"},de={key:1,class:"mb-0"},re={key:2,class:"mb-0"},ce={key:3,class:"mb-0"},ue=["disabled","onClick"],ie=c(()=>t("span",{class:"material-symbols-outlined"}," edit ",-1)),me=c(()=>t("span",{class:"d-none d-xl-block"},"修改",-1)),he=[ie,me],pe={class:"d-flex justify-content-end gap-3 mt-5"},_e=["disabled"],be={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},fe={class:"modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable"},ve={class:"modal-content"},ke=c(()=>t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"修改佛七報名資料"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ge={class:"modal-body p-5"},xe={class:"bg-secondary-tint mb-3 p-3 rounded-4 d-flex gap-3 shadow-sm"},ye={key:0,class:"fs-4 flex-grow-1"},De={key:1,class:"fs-4 flex-grow-1"},we={class:"fs-4 flex-grow-1"},Ce={class:"d-flex gap-3"},Ie={class:"mb-4 flex-grow-1"},Se=c(()=>t("label",{for:"checkIn",class:"form-label fw-semibold"},"預計報到日",-1)),Oe={class:"mb-4 flex-grow-1"},Me=c(()=>t("label",{for:"checkOut",class:"form-label fw-semibold"},"預計離單日",-1)),Ne=c(()=>t("p",{class:"fs-5 fw-semibold my-3"},"報到日用齋",-1)),$e=["value","id","onUpdate:modelValue"],Ue=["for"],Le={class:"fw-semibold me-2"},Be={class:"mt-5"},Ve=c(()=>t("label",{for:"msg",class:"h3 mb-4 fw-semibold"},"備註",-1)),Fe={class:"modal-footer"},Ye=c(()=>t("button",{type:"button",class:"btn btn-outline-neutral-80","data-bs-dismiss":"modal"}," 取消 ",-1)),Re=F({__name:"BuddhaList",setup(g){const h=f(new Date().getFullYear()),u=f(new Date().getMonth()+1),i=q(),a=f({DharmaName:"",Name:"",Mobile:"",Phone:"",CheckInDate:"",CheckOutDate:"",CheckInDateLunch:!1,CheckInDateDinner:!1,Remarks:""});Y(()=>a.value,()=>{a.value.CheckInDate=U(new Date(a.value.CheckInDate).valueOf(),!0,"-"),a.value.CheckOutDate=U(new Date(a.value.CheckOutDate).valueOf(),!0,"-")});const B=f([{title:"報名序號",needSort:!0},{title:"性別",needSort:!1},{title:"法名",needSort:!1},{title:"俗名",needSort:!1},{title:"電話",needSort:!1},{title:"預計報到日",needSort:!0},{title:"預計離單日",needSort:!0},{title:"報到當天用齋",needSort:!1},{title:"狀態",needSort:!0},{title:"登錄 / 修改者",needSort:!1},{title:"登錄 / 修改日期",needSort:!0},{title:"修改",needSort:!1}]);R(()=>{i.getOrderList(h.value,u.value)});const x=f({Id:0});async function V(m){if(i.totalOrder.findIndex(_=>_.Id===m.Id)===-1){$.fire({icon:"error",title:"還未選擇四眾法眷",showConfirmButton:!1,timer:1500});return}try{(await $.fire({html:`<p class="mb-0 fs-3">是否取消<b class="px-2 text-danger fw-semibold">${m.DharmaName?`${m.DharmaName}-`:""}${m.Name?`${m.Name}-`:""}${m.IsMale?"男":"女"}</b>的預約</p>`,showCancelButton:!0})).isConfirmed&&i.deleteOrder(m.Id,h.value,u.value)}catch(_){console.error(_)}}return(m,s)=>{const _=j("router-link");return n(),o("main",J,[t("div",K,[C(H,null,{title:y(()=>[k(" 佛七預約報名表單 ")]),_:1}),t("div",Q,[t("div",null,[W,b(t("select",{id:"year",class:"form-select form-select-lg fs-5","aria-label":".form-select-lg example","onUpdate:modelValue":s[0]||(s[0]=e=>h.value=e),onChange:s[1]||(s[1]=e=>d(i).getOrderList(h.value,u.value))},[(n(!0),o(p,null,v(new Date().getFullYear()-2009,e=>(n(),o("option",{value:new Date().getFullYear()+1-e,key:e,selected:e+2010===new Date().getFullYear()-2009},l(new Date().getFullYear()+1-e),9,X))),128))],544),[[M,h.value]])]),t("div",null,[Z,b(t("select",{id:"month",class:"form-select form-select-lg fs-5","aria-label":".form-select-lg example","onUpdate:modelValue":s[2]||(s[2]=e=>u.value=e),onChange:s[3]||(s[3]=e=>d(i).getOrderList(h.value,u.value))},[(n(),o(p,null,v(12,e=>t("option",{value:e,key:e,selected:e===u.value},l(e),9,ee)),64))],544),[[M,u.value]])])]),C(G,null,{thead:y(()=>[t("tr",null,[(n(!0),o(p,null,v(B.value,(e,r)=>(n(),o("th",{key:e.title+r,class:D({"cursor-point":e.needSort})},[k(l(e.title)+" ",1),e.needSort?(n(),o("span",te," arrow_drop_up ")):A("",!0)],2))),128))])]),tbody:y(()=>[d(i).totalOrder.length?(n(!0),o(p,{key:1},v(d(i).totalOrder,(e,r)=>(n(),o("tr",{key:e.Id+r,class:D({"table-active":x.value.Id===e.Id}),onClick:N(w=>x.value=e,["prevent"])},[t("td",null,l(r+1),1),t("td",null,l(e.IsMale?"男":"女"),1),t("td",null,l(e.DharmaName),1),t("td",null,l(e.Name),1),t("td",null,l(e.Mobile||e.Phone),1),t("td",null,l(d(S)(new Date(e.CheckInDate).valueOf()))+" / "+l(d(O)(new Date(e.CheckInDate).valueOf())),1),t("td",null,l(d(S)(new Date(e.CheckOutDate).valueOf()))+" / "+l(d(O)(new Date(e.CheckOutDate).valueOf())),1),t("td",null,[e.Status==="已取消"?(n(),o(p,{key:0},[k("已取消")],64)):(n(),o(p,{key:1},[e.CheckInDateDinner&&e.CheckInDateLunch?(n(),o("p",ne," 用午齋、藥石 ")):e.CheckInDateLunch?(n(),o("p",de,"用午齋")):e.CheckInDateDinner?(n(),o("p",re,"用藥石")):(n(),o("p",ce,"不用齋"))],64))]),t("td",null,[t("p",{class:D(["py-2 px-3 mb-0 rounded-4",`bg-${d(L)[e.Status].bgColor} text-${d(L)[e.Status].textColor}`])},l(e.Status),3)]),t("td",null,l(e.UpdateUserDharmaName),1),t("td",null,l(d(S)(new Date(e.UpdateAt).valueOf()))+" / "+l(d(O)(new Date(e.UpdateAt).valueOf())),1),t("td",null,[t("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#exampleModal",disabled:e.Status==="已取消掛單",class:"btn border-0 mb-0 d-flex align-items-center justify-content-center gap-2",onClick:w=>a.value=e},he,8,ue)])],10,oe))),128)):(n(),o("tr",le,se))]),_:1}),t("div",pe,[t("button",{type:"button",class:"btn btn-outline-primary py-3 flex-grow-1",style:{"max-width":"184px"},onClick:s[4]||(s[4]=N(e=>V(x.value),["prevent"])),disabled:x.value.Status==="已取消"}," 取消預約 ",8,_e),C(_,{to:"/back/buddha/signUp?step=1",type:"button",class:"btn btn-primary py-3 flex-grow-1",style:{"max-width":"184px"}},{default:y(()=>[k(" 報名佛七 ")]),_:1})]),t("div",be,[t("div",fe,[t("div",ve,[ke,t("div",ge,[t("div",xe,[a.value.DharmaName?(n(),o("p",ye," 法名："+l(a.value.DharmaName),1)):(n(),o("p",De,"俗名："+l(a.value.Name),1)),t("p",we,"電話："+l(a.value.Mobile||a.value.Phone),1)]),t("div",Ce,[t("div",Ie,[Se,b(t("input",{type:"date",class:"form-control",id:"checkIn","onUpdate:modelValue":s[5]||(s[5]=e=>a.value.CheckInDate=e)},null,512),[[I,a.value.CheckInDate]])]),t("div",Oe,[Me,b(t("input",{type:"date",class:"form-control",id:"checkOut","onUpdate:modelValue":s[6]||(s[6]=e=>a.value.CheckOutDate=e)},null,512),[[I,a.value.CheckOutDate]])])]),t("div",null,[Ne,(n(),o(p,null,v({午齋:{config:"CheckInDateLunch",content:"用齋時間11：10，要用午齋者請於10：30前報到"},藥石:{config:"CheckInDateDinner",content:"用齋時間17：10，要用藥石者請於15：00前報到"}},(e,r)=>t("div",{class:D(["form-check",{"mb-3":r==="午齋"}]),key:r+e.content},[b(t("input",{class:"form-check-input",type:"checkbox",value:r,id:r,"onUpdate:modelValue":w=>a.value[e.config]=w},null,8,$e),[[P,a.value[e.config]]]),t("label",{class:"form-check-label fs-5",for:r},[t("span",Le,l(r),1),k(l(e.content),1)],8,Ue)],2)),64)),t("section",Be,[Ve,b(t("textarea",{class:"form-control rounded-4",id:"msg",style:{"min-height":"10rem"},"onUpdate:modelValue":s[7]||(s[7]=e=>a.value.Remarks=e)},null,512),[[I,a.value.Remarks]])])])]),t("div",Fe,[Ye,t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:s[8]||(s[8]=e=>d(i).editorInfo(a.value,h.value,u.value))}," 確認 ")])])])])])])}}});const Ke=E(Re,[["__scopeId","data-v-7716bf8f"]]);export{Ke as default};
