import{A as g,P as d}from"./index-0a7f7a6a.js";import{a as c}from"./SweetAlert-183ed47c.js";const{VITE_BASEURL:l}={VITE_BASEURL:"https://donglin-temple-backend-00pk.onrender.com/api",BASE_URL:"/donglin-temple-system/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},h=g("userStore",{state:()=>({isLogin:!1,user:{DharmaName:"",Name:""},deaconName:""}),actions:{async checkLogin(e){if(this.isLogin=!!localStorage.isLogin,!e){this.overLogin();return}this.user=sessionStorage.user&&JSON.parse(sessionStorage.user),this.deaconName=sessionStorage.deaconName,d.defaults.headers.common.Authorization=`Bearer ${e}`;const s=`${l}/managers/check`;try{if((await d.post(s)).data.status&&!this.isLogin&&(this.isLogin=!0,localStorage.setItem("isLogin","true")),this.user)return;const r=await d.get(`${l}/managers/profile`),{userId:a,deaconName:i}=r.data.data,t=await d.get(`${l}/users/${a}`),{user:n}=t.data.data;this.user=n,this.deaconName=i,sessionStorage.setItem("deaconName",i),sessionStorage.setItem("user",JSON.stringify(n))}catch(o){console.error(o),this.overLogin()}},async login(e,s,o=!1,r){const a=`${l}/managers/signin`,i={Email:e,Password:s};try{const t=await d.post(a,i);if(t.data.status){o?localStorage.setItem("userAccount",e):localStorage.removeItem("userAccount");const n=await c.fire(t.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",t.data.data.deaconName),(n.isConfirmed||n.isDismissed)&&(document.cookie=`token=${t.data.data.token}; expires=${new Date(t.data.data.expired*1e3)}`,r.push("/"))}}catch(t){c.fire({icon:"error",title:t.response.data.message})}},async lineLogin(e,s){const o=`${l}/managers/line/signin`,r=e;console.log(r);try{const a=await d.post(o,r);if(a.data.status){const i=await c.fire(a.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",a.data.data.deaconName),(i.isConfirmed||i.isDismissed)&&(document.cookie=`token=${a.data.data.token}; expires=${new Date(a.data.data.expired*1e3)}`,s.push("/"))}}catch(a){(await c.fire({icon:"error",title:a.response.data.message})).isConfirmed&&s.push("/admin")}},async register(e,s,o,r,a){const i=`${l}/managers/signup${a?`/${a}`:""}`,t={Email:e,Password:s,ConfirmPassword:o,UserId:r};try{if((await d.post(i,t)).data.status){const m=await c.fire("註冊成功");this.clearCookie(),(m.isConfirmed||m.isDismissed)&&(window.location.href="/")}}catch(n){c.fire({icon:"error",title:n.response.data.message}),console.error(n.response.data)}},async signOut(e){this.clearCookie();const s=await c.fire("登出成功");(s.isConfirmed||s.isDismissed)&&e.push("/")},async overLogin(){if(this.clearCookie(),window.location.hash!=="#/"){const e=await c.fire("請重新登入");(e.isConfirmed||e.isDismissed)&&(window.location.href=`${window.location.origin}/#/admin`)}},clearCookie(){this.isLogin=!1,localStorage.setItem("isLogin","false"),document.cookie=`token=;expires=${new Date}`,sessionStorage.clear()},getToken(){var s;return document.cookie.includes("token")&&((s=document.cookie.split("; ").find(o=>o.startsWith("token=")))==null?void 0:s.split("=")[1])||""}}});export{h as u};
