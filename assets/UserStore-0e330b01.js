import{A as u,P as d}from"./index-3e683233.js";import{a as r}from"./SweetAlert-183ed47c.js";const{VITE_BASEURL:m}={VITE_BASEURL:"https://donglin-temple-backend-00pk.onrender.com/api",BASE_URL:"/donglin-temple-system/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},p=u("userStore",{state:()=>({isLogin:!1,user:{DharmaName:"",Name:""},deaconName:""}),actions:{async checkLogin(e){if(this.isLogin=!!localStorage.isLogin,!e){this.overLogin();return}this.user=sessionStorage.user&&JSON.parse(sessionStorage.user),this.deaconName=sessionStorage.deaconName,d.defaults.headers.common.Authorization=`Bearer ${e}`;const s=`${m}/managers/check`;try{if((await d.post(s)).data.status&&!this.isLogin&&(this.isLogin=!0,localStorage.setItem("isLogin","true")),this.user)return;const n=await d.get(`${m}/managers/profile`),{userId:a,deaconName:i}=n.data.data,t=await d.get(`${m}/users/${a}`),{user:c}=t.data.data;this.user=c,this.deaconName=i,sessionStorage.setItem("deaconName",i),sessionStorage.setItem("user",JSON.stringify(c))}catch(o){console.error(o),this.overLogin()}},async login(e,s,o=!1,n){const a=`${m}/managers/signin`,i={Email:e,Password:s};try{const t=await d.post(a,i);if(t.data.status){o?localStorage.setItem("userAccount",e):localStorage.removeItem("userAccount");const c=await r.fire(t.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",t.data.data.deaconName),(c.isConfirmed||c.isDismissed)&&(document.cookie=`token=${t.data.data.token}; expires=${new Date(t.data.data.expired*1e3)}`,n.push("/"))}}catch(t){r.fire({icon:"error",title:t.response.data.message})}},async lineLogin(e,s){const o=`${m}/managers/line/signin`,n=e;console.log(n);try{const a=await d.post(o,n);if(a.data.status){const i=await r.fire(a.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",a.data.data.deaconName),(i.isConfirmed||i.isDismissed)&&(document.cookie=`token=${a.data.data.token}; expires=${new Date(a.data.data.expired*1e3)}`,s.push("/"))}}catch(a){(await r.fire({icon:"error",title:a.response.data.message})).isConfirmed&&s.push("/admin")}},async register(e,s,o,n,a,i){const t=`${m}/managers/signup${a?`/${a}`:""}`,c={Email:e,Password:s,ConfirmPassword:o,UserId:n};try{if((await d.post(t,c)).data.status){const g=await r.fire("註冊成功");this.clearCookie(),(g.isConfirmed||g.isDismissed)&&i.push("/")}}catch(l){r.fire({icon:"error",title:l.response.data.message}),console.error(l.response.data)}},async signOut(e){this.clearCookie();const s=await r.fire("登出成功");(s.isConfirmed||s.isDismissed)&&e.push("/")},async overLogin(){if(this.clearCookie(),window.location.hash!=="#/"){const e=await r.fire("請重新登入");(e.isConfirmed||e.isDismissed)&&(window.location.href=`${window.location.origin}/#/admin`)}},clearCookie(){this.isLogin=!1,localStorage.setItem("isLogin","false"),document.cookie=`token=;expires=${new Date}`,sessionStorage.clear()},getToken(){var s;return document.cookie.includes("token")&&((s=document.cookie.split("; ").find(o=>o.startsWith("token=")))==null?void 0:s.split("=")[1])||""}}});export{p as u};
