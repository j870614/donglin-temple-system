import{A as g,P as c}from"./index-8954a36c.js";import{a as r}from"./SweetAlert-183ed47c.js";const{VITE_BASEURL:l}={VITE_BASEURL:"https://donglin-temple-backend-00pk.onrender.com/api",BASE_URL:"/donglin-temple-system/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},w=g("userStore",{state:()=>({isLogin:!1,user:{DharmaName:"",Name:""},deaconName:""}),actions:{async checkLogin(e){if(this.isLogin=!!localStorage.isLogin,!e){this.overLogin();return}this.user=sessionStorage.user&&JSON.parse(sessionStorage.user),this.deaconName=sessionStorage.deaconName,c.defaults.headers.common.Authorization=`Bearer ${e}`;const t=`${l}/managers/check`;try{if((await c.post(t)).data.status&&!this.isLogin&&(this.isLogin=!0,localStorage.setItem("isLogin","true")),this.user)return;const s=await c.get(`${l}/managers/profile`),{userId:i,deaconName:a}=s.data.data,d=await c.get(`${l}/users/${i}`),{user:n}=d.data.data;this.user=n,this.deaconName=a,sessionStorage.setItem("deaconName",a),sessionStorage.setItem("user",JSON.stringify(n))}catch(o){console.error(o)}},async login(e,t,o=!1){const s=`${l}/managers/signin`,i={Email:e,Password:t};try{const a=await c.post(s,i);if(a.data.status){o?localStorage.setItem("userAccount",e):localStorage.removeItem("userAccount");const d=await r.fire(a.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",a.data.data.deaconName),(d.isConfirmed||d.isDismissed)&&(document.cookie=`token=${a.data.data.token}; expires=${new Date(a.data.data.expired*1e3)}`,window.location.href="/")}}catch(a){r.fire({icon:"error",title:a.response.data.message})}},async lineLogin(e){const t=`${l}/managers/line/signin`,o=e;try{const s=await c.post(t,o);if(s.data.status){const i=await r.fire(s.data.message);localStorage.setItem("isLogin","true"),sessionStorage.setItem("deaconName",s.data.data.deaconName),(i.isConfirmed||i.isDismissed)&&(document.cookie=`token=${s.data.data.token}; expires=${new Date(s.data.data.expired*1e3)}`,window.location.href="/")}}catch(s){r.fire({icon:"error",title:s.response.data.message})}},async register(e,t,o,s,i){const a=`${l}/managers/signup${i?`/${i}`:""}`,d={Email:e,Password:t,ConfirmPassword:o,UserId:s};try{const n=await c.post(a,d);if(n.data.status){const m=await r.fire("註冊成功");this.clearCookie(),console.log("user register"),console.log(n.data),console.log("----------"),(m.isConfirmed||m.isDismissed)&&(window.location.href="/")}}catch(n){r.fire({icon:"error",title:n.response.data.message}),console.error(n.response.data)}},async signOut(){this.clearCookie();const e=await r.fire("登出成功");(e.isConfirmed||e.isDismissed)&&(window.location.href="/")},async overLogin(){if(this.clearCookie(),window.location.hash!=="#/"){const e=await r.fire("請重新登入");(e.isConfirmed||e.isDismissed)&&(window.location.href=`${window.location.origin}/#/admin`)}},clearCookie(){this.isLogin=!1,localStorage.setItem("isLogin","false"),document.cookie=`token=;expires=${new Date}`},getToken(){var t;return document.cookie.includes("token")&&((t=document.cookie.split("; ").find(o=>o.startsWith("token=")))==null?void 0:t.split("=")[1])||""}}});export{w as u};
