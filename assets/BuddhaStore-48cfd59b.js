import{A as l,P as i}from"./index-0a7f7a6a.js";import{a as c}from"./SweetAlert-183ed47c.js";import{G as u}from"./GuestStore-a6700c3e.js";const{VITE_BASEURL:d}={VITE_BASEURL:"https://donglin-temple-backend-00pk.onrender.com/api",BASE_URL:"/donglin-temple-system/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},g=l("buddhaStore",{state:()=>({totalBuddha:[],totalOrder:[],checkInOrder:[],ajaxFinish:!1,curBuddhaUser:{}}),actions:{async getTotal(e){const s=`${d}/buddha-seven/periods?year=${e}`,a=await i.get(s);this.totalBuddha=a.data.data.buddhaSevenPeriods},async addBuddha(e){const{StartSevenDate:s,CompleteDate:a,Remarks:r}=e,o=`${d}/buddha-seven/periods`,n={StartSevenDate:s,CompleteDate:a,Remarks:r};try{const t=await i.post(o,n);return c.fire({icon:"success",title:t.data.message}),1}catch(t){return c.fire({icon:"error",title:t.response.data.message}),0}},async editorBuddha(e){const{StartSevenDate:s,CompleteDate:a,Remarks:r,Id:o}=e,n=`${d}/buddha-seven/periods/${o}`,t={StartSevenDate:s,CompleteDate:a,Remarks:r};try{const h=await i.patch(n,t);return c.fire({icon:"success",title:h.data.message}),1}catch(h){return c.fire({icon:"error",title:h.response.data.message}),0}},async applyBuddha(e,s){const a=`${d}/buddha-seven/applies`,r=[],o=[],n=u();e.forEach(t=>{const h={UserId:t.Id,CheckInDate:new Date(t.date[0]),CheckOutDate:new Date(t.date[1]),CheckInDateBreakfast:t.CheckInDateBreakfast,CheckInDateLunch:t.CheckInDateLunch,CheckInDateDinner:t.CheckInDateDinner,Remarks:t.Remarks||"",UpdateUserId:JSON.parse(sessionStorage.user).Id};r.push(i.post(a,h)),o.push(n.editorInfo(t.Id,t))});try{const t=await Promise.all([...r,...o]);(await c.fire({icon:"success",title:t[0].data.message,showConfirmButton:!1,timer:1500})).isDismissed&&(sessionStorage.removeItem("totalTemp"),s.push("/back/buddha/signUp?step=1"))}catch(t){c.fire({icon:"error",title:t.response.data.message})}},async getOrderList(e,s){const a=`${d}/buddha-seven/applies/views?year=${e}&month=${s}`;try{const r=await i.get(a);this.totalOrder=r.data.data.buddhaSevenApplyViews}catch(r){c.fire({icon:"error",title:r.response.data.message})}},async getBuddhaUser(e){try{const s=await i.get(`${d}/buddha-seven/applies/views/${e}`);this.curBuddhaUser=s.data.data.buddhaSevenApplyView}catch(s){c.fire({icon:"error",title:s.response.data.message})}},async deleteOrder(e,s,a){const r=`${d}/buddha-seven/applies/cancel/${e}?UpdateUserId=${JSON.parse(sessionStorage.user).Id}`;try{const o=await i.patch(r);c.fire({icon:"success",title:o.data.message,showConfirmButton:!1,timer:1500}),this.getOrderList(s,a)}catch(o){c.fire({icon:"error",title:o.response.data.message})}},async editorInfo(e,s,a){const r=`${d}/buddha-seven/applies/${e.Id}`,o={UserId:e.UserId,CheckInDate:new Date(e.CheckInDate),CheckOutDate:new Date(e.CheckOutDate),CheckInDateBreakfast:e.CheckInDateBreakfast,CheckInDateLunch:e.CheckInDateLunch,CheckInDateDinner:e.CheckInDateDinner,Remarks:e.Remarks?e.Remarks:"",UpdateUserId:JSON.parse(sessionStorage.user).Id};try{const n=await i.patch(r,o);c.fire({icon:"success",title:n.data.message,showConfirmButton:!1,timer:1500}),this.getOrderList(s,a)}catch(n){c.fire({icon:"error",title:n.response.data.message})}},async getCheckInList(){const e=`${d}/buddha-seven/check-ins/views`;try{const s=await i.get(e);this.checkInOrder=s.data.data.buddhaSevenApplyViews}catch(s){c.fire({icon:"error",title:s.response.data.message})}},async checkInBuddha(e,s,a){const r=`${d}/buddha-seven/check-ins/${e}`,o={UpdateUserId:JSON.parse(sessionStorage.user).Id,CheckInUserId:JSON.parse(sessionStorage.user).Id,Remarks:s.Remarks||""};try{const n=s;n.Expertise=JSON.stringify(s.Expertise),n.HealthStatus=JSON.stringify(s.HealthStatus);const t=u(),h=await Promise.all([i.patch(r,o),t.editorInfo(n.Id,n)]);(await c.fire({icon:"success",title:h[0].data.message})).isConfirmed&&(this.getCheckInList(),a.push("/back/buddha/checkIn?step=1"))}catch(n){(await c.fire({icon:"error",title:n.response.data.message})).isConfirmed&&a.push("/back/buddha/checkIn?step=1")}}}});export{g as B};
